import { NextPage } from "next";
import Head from "next/head";
import React, { useState } from "react";
import Footer from "../components/Footer";
import Header from "../components/Header";
import Main from "../components/Main";
import { CardType } from "../types/types";

type PropsType = {
    mainData:  Array<CardType>
    drawData:  Array<CardType>
}

const Home: NextPage<PropsType> = ({mainData, drawData}) => {
  const [item, setItem] = useState<Array<CardType>>(drawData)

  const onAddToDrawer = async (obj: CardType) => {
    try {
      await fetch('https://630f1ba6498924524a860c3f.mockapi.io/draw', {
        method: 'POST',
        body: JSON.stringify(obj),
        headers: {
          'Content-Type': 'application/json'
        }
      })
     setItem(prev => [...prev, obj])
    } catch (error) {
      throw new Error(`Error in onAddToDrawer: ${error}`);
    }
  }

  const onRemoveCardDrawer = async (id: number) => {
    try {
      await fetch(`https://630f1ba6498924524a860c3f.mockapi.io/draw/${id}`, {
        method: 'DELETE',
      })
    setItem(item.filter((el: CardType) => el.id !== id)) 
    } catch (error) {
      throw new Error(`Error in onRemoveCardDrawer: ${error}`);
            
    }
  }
  

  return (
    <>
      <Head>
        <title>React-boots</title>
        <meta name="description" content="Generated by create next app" />
      </Head>
      <Header item={item} onRemoveCardDrawer={onRemoveCardDrawer}/>
      <Main mainData={mainData} onAddToDrawer={onAddToDrawer} drawData={drawData}/>
      <Footer />
    </>
  )
}

Home.getInitialProps = async () => {
  const res = await fetch('https://630f1ba6498924524a860c3f.mockapi.io/users')
  const mainData = await res.json()
  const resDraw = await fetch('https://630f1ba6498924524a860c3f.mockapi.io/draw')
  const drawData = await resDraw.json()
  return {mainData, drawData}
}

export default Home;
